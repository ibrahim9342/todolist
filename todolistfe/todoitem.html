<!DOCTYPE html>
<html lang="en">

<head>
    <title>ToDoItem</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.15.1/moment.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datetimepicker/4.7.14/js/bootstrap-datetimepicker.min.js"></script>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datetimepicker/4.7.14/css/bootstrap-datetimepicker.min.css">

    <script type="text/javascript" src=" https://cdn.datatables.net/1.10.13/js/jquery.dataTables.min.js"></script>

    <style>
        .btn-group {
            margin: 5px!important;
        }
        
        .mm {
            margin: 10px!important;
        }
    </style>

</head>

<body>

    <div class="container">
        <h3><div id="listname"> </div></h3>

        <button type="button" class="btn btn-info btn-lg" data-toggle="modal" style="margin-bottom:10px!important" data-target="#newtodo">Yeni Madde Ekle</button>
        <button type="button" onclick="exit()" class="btn btn-danger btn-lg" style="margin-bottom:10px!important;float:right">Çıkış Yap</button>
        <div>

            <div style="width:50%!important;float:left;">
                <h4 style="margin:3px!important">Filtre Alanları</h4>
                <table style="margin:10px!important">

                    <tr>
                        <td>
                            <div id="statufilter" class="btn-group" data-toggle="buttons">
                                <label class="btn btn-primary active" onclick="getstatu('itemall');">
                                    <input type="radio" name="options" id="itemall" checked value="asd"> Tümü
                                </label>
                                <label class="btn btn-primary" onclick="getstatu('itemall0')">
                                    <input type="radio" name="options" id="itemall1"> Tamamlananlar
                                </label>
                                <label class="btn btn-primary" onclick="getstatu('itemall1')">
                                    <input type="radio" name="options" id="itemall0"> Devam Edenler
                                </label>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <div id="timefilter" class="btn-group" data-toggle="buttons">
                                <label class="btn btn-primary active" onclick="getfiltertime('time');">
                                    <input type="radio" name="options" id="itemall" checked value="asd"> Tümü
                                </label>
                                <label class="btn btn-primary" onclick="getfiltertime('time1')">
                                    <input type="radio" name="options" id="itemall1"> Süresi Dolmuş
                                </label>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <input type='text' name="searchname" id="searchname" placeholder="Ada Göre Ara" class="form-control" style="margin:5px!important" />
                        </td>
                        <td>
                            <button onclick="filtersearchname()" class="btn btn-info" style="margin-left:10px!important">Ara</button>
                        </td>
                    </tr>
                </table>

            </div>

            <div style="width:50%!important;float:left">
                <h4 style="margin:3px!important">Sırala</h4>

                <button onclick="ordercreatedat('ASC')" class="btn btn-info" style="margin:10px!important">Oluşturulma Tarihi Artan </button>
                <button onclick="ordercreatedat('DESC')" class="btn btn-info" style="margin:10px!important">Oluşturulma Tarihi Azalan </button>
                <div>
                    <h3>
*Diğer alanlara göre sıralama yapmak için tabloda bulunan başlıklara tıklayınız
</h3>
                </div>
            </div>
        </div>
        <div style="width:100%!important;margin-top:10px!important;float:left;">
            <table id="tododatatable" class="table" cellspacing="0">
                <thead>
                    <tr>
                        <th>Durum</th>
                        <th>Madde Adı</th>
                        <th>Açıklama</th>
                        <th>Teslim Tarihi</th>
                        <th>Durumu</th>
                        <th>İşlemler</th>
                    </tr>
                </thead>
            </table>
        </div>
    </div>

    <div class="modal fade" id="newtodo" role="dialog">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4 class="modal-title">Yeni Ekle</h4>
                </div>
                <div class="modal-body">
                    <p>
                        <form id="newToDoForm">
                            <input class="form-control mm" id="itemName" name="itemName" placeholder="Madde Adı" required="true">
                            <div class='input-group date mm' id='datetimepicker1'>
                                <input type='text' name="deadLine" id="deadLine" class="form-control" placeholder="Teslim Tarihi" />
                                <span class="input-group-addon">
		                <span class="glyphicon glyphicon-calendar input-group"></span>
                                </span>
                            </div>
                            <textarea id="description" name="description" class="md-textarea form-control mm" placeholder="Açıklama" rows="3"></textarea>
                        </form>
                    </p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Kapat</button>
                    <button onclick="save()" class="btn btn-info">Kaydet</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        var filterstatu = "itemall";
        var filterexpired = "time";
        var searchname = "";

        $(function() {
            $('#datetimepicker1').datetimepicker();
            $('#statu').removeClass('active');

            $("#" + filterstatu).button('toggle')
        });

        $(document).ready(function() {
            if (sessionStorage.getItem("id") === null) {
                document.location = "index.html";
            }
            $("#listname").html(sessionStorage.getItem("listname"));
            list();
        });

        function exit() {
            sessionStorage.setItem("id", "");
            document.location = "index.html";
        }

        function getstatu(statuname) {
            filterstatu = statuname;
            var dataTable = $('#tododatatable').dataTable();
            dataTable.fnClearTable();
            dataTable.fnDraw();
            dataTable.fnDestroy();
            filter();
        }

        function getfiltertime(timename) {
            filterexpired = timename;
            var dataTable = $('#tododatatable').dataTable();
            dataTable.fnClearTable();
            dataTable.fnDraw();
            dataTable.fnDestroy();
            filter();
        }

        function filtersearchname() {
            searchname = document.getElementById("searchname").value;
            var dataTable = $('#tododatatable').dataTable();
            dataTable.fnClearTable();
            dataTable.fnDraw();
            dataTable.fnDestroy();
            filter();
        }

        function ordercreatedat(type) {

            var dataTable = $('#tododatatable').dataTable();
            dataTable.fnClearTable();
            dataTable.fnDraw();
            dataTable.fnDestroy();

            $('#tododatatable').DataTable({
                processing: true,
                bPaginate: false,
                ajax: {
                    url: "http://localhost:9090/todoitem/ordertype/" + sessionStorage.getItem("listid") + "/" + type + "/",
                    type: "GET",
                    crossDomain: true,
                    contentType: 'application/json; charset=utf-8',
                    dataSrc: function(json) {
                        for (var i = 0; i < json.length; i++) {
                            var obj = json[i];
                            console.log(obj);
                            if (obj["statu"] === "0") {
                                obj["check"] = "<input type='checkbox' class='form-check-input' onchange='complate(\"" + obj["id"] + "\",\"1\")' >";
                                obj["statutext"] = "<font color='orrange'>Devam Ediyor</font>";
                            } else {
                                obj["check"] = "<input type='checkbox' class='form-check-input'  checked='checked' onchange='complate(\"" + obj["id"] + "\",\"0\")'>";
                                obj["statutext"] = "<font color='green'>Tamamlandı</font>";
                            }

                            obj["detail"] = "<a href='javascript:deleteToDo(\"" + obj["id"] + "\");' style='color:red;margin-left:5px!important;'>Sil</a>";
                            json[i] = obj;
                        }
                        return json;
                    }
                },
                "columns": [{
                    "data": "check"
                }, {
                    "data": "itemName"
                }, {
                    "data": "description"
                }, {
                    "data": "deadLine"
                }, {
                    "data": "statutext"
                }, {
                    "data": "detail"
                }]
            });
        }

        function filter() {
            var obj = {
                statu: filterstatu.replace("itemall", ""),
                expired: filterexpired.replace("time", ""),
                searchname: searchname,
                id: "2"
            };
            var targeturl = "http://localhost:9090/todoitem/" + sessionStorage.getItem("listid") + "/s" + filterstatu.replace("itemall", "") + "/e" + filterexpired.replace("time", "") + "/n" + searchname;
            console.log(JSON.stringify(obj));

            $('#tododatatable').DataTable({
                processing: true,
                bPaginate: false,
                ajax: {
                    url: targeturl,
                    type: "GET",

                    crossDomain: true,
                    contentType: 'application/json; charset=utf-8',
                    dataSrc: function(json) {
                        for (var i = 0; i < json.length; i++) {
                            var obj = json[i];
                            console.log(obj);
                            if (obj["statu"] === "0") {
                                obj["check"] = "<input type='checkbox' class='form-check-input' onchange='complate(\"" + obj["id"] + "\",\"1\")' >";
                                obj["statutext"] = "<font color='orrange'>Devam Ediyor</font>";
                            } else {
                                obj["check"] = "<input type='checkbox' class='form-check-input'  checked='checked' onchange='complate(\"" + obj["id"] + "\",\"0\")'>";
                                obj["statutext"] = "<font color='green'>Tamamlandı</font>";
                            }

                            obj["detail"] = "<a href='javascript:deleteToDo(\"" + obj["id"] + "\");' style='color:red;margin-left:5px!important;'>Sil</a>";
                            json[i] = obj;
                        }
                        return json;
                    }
                },
                "columns": [{
                    "data": "check"
                }, {
                    "data": "itemName"
                }, {
                    "data": "description"
                }, {
                    "data": "deadLine"
                }, {
                    "data": "statutext"
                }, {
                    "data": "detail"
                }]
            });

        }

        function complate(id, statu) {

            var targeturl = "http://localhost:9090/todoitem/complate/" + id + "/" + statu;
            $.ajax({
                url: targeturl,
                type: "PUT",
                crossDomain: true,
                contentType: 'application/json; charset=utf-8',
                success: function(resultData) {
                    if (resultData === null) {
                        alert("Hata Oluştu");
                    } else {
                        var dataTable = $('#tododatatable').dataTable();
                        dataTable.fnClearTable();
                        dataTable.fnDraw();
                        dataTable.fnDestroy();
                        list();
                    }
                },
                error: function() {
                    alert("Hata Oluştu");
                }
            });

        }

        function list() {
            $('#tododatatable').DataTable({
                processing: true,
                bPaginate: false,
                ajax: {
                    url: "http://localhost:9090/todoitem/" + sessionStorage.getItem("listid"),
                    type: "GET",
                    dataSrc: function(json) {
                        for (var i = 0; i < json.length; i++) {
                            var obj = json[i];
                            console.log(obj);
                            if (obj["statu"] === "0") {
                                obj["check"] = "<input type='checkbox' class='form-check-input' onchange='complate(\"" + obj["id"] + "\",\"1\")' >";
                                obj["statutext"] = "<font color='orrange'>Devam Ediyor</font>";
                            } else {
                                obj["check"] = "<input type='checkbox' class='form-check-input'  checked='checked' onchange='complate(\"" + obj["id"] + "\",\"0\")'>";
                                obj["statutext"] = "<font color='green'>Tamamlandı</font>";
                            }

                            obj["detail"] = "<a href='javascript:deleteToDo(\"" + obj["id"] + "\");' style='color:red;margin-left:5px!important;'>Sil</a>";
                            json[i] = obj;
                        }
                        return json;
                    }
                },
                "columns": [{
                    "data": "check"
                }, {
                    "data": "itemName"
                }, {
                    "data": "description"
                }, {
                    "data": "deadLine"
                }, {
                    "data": "statutext"
                }, {
                    "data": "detail"
                }]
            });

        }

        function deleteToDo(id) {
            var targeturl = "http://localhost:9090/todoitem/delete/" + id;
            $.ajax({
                url: targeturl,
                type: "DELETE",
                crossDomain: true,
                contentType: 'application/json; charset=utf-8',
                success: function(resultData) {
                    if (resultData === null) {
                        alert("Hata Oluştu");
                    } else {
                        var dataTable = $('#tododatatable').dataTable();
                        dataTable.fnClearTable();
                        dataTable.fnDraw();
                        dataTable.fnDestroy();
                        list();
                    }
                },
                error: function() {
                    alert("Hata Oluştu");
                }
            });
        }

        function save() {
            var targeturl = "http://localhost:9090/todoitem/save";
            var obj = {
                todolistid: sessionStorage.getItem("listid"),
                itemName: document.getElementById("itemName").value,
                description: document.getElementById("description").value,
                deadLine: document.getElementById("deadLine").value,
                statu: "0"
            };
            document.getElementById("newToDoForm").reset();
            $.ajax({
                url: targeturl,
                type: "POST",
                data: JSON.stringify(obj),
                crossDomain: true,
                contentType: 'application/json; charset=utf-8',
                success: function(resultData) {
                    $('#newtodo').modal('hide');
                    if (resultData === null) {
                        alert("Kayıt Oluştrulurken Bir Hata Oldu");
                    } else {
                        var dataTable = $('#tododatatable').dataTable();
                        dataTable.fnClearTable();
                        dataTable.fnDraw();
                        dataTable.fnDestroy();
                        list();
                    }
                },
                error: function() {
                    alert("Bir Hata Oluştu");
                }
            });
        }
    </script>

</body>

</html>
